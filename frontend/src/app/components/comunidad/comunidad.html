<div class="comunidad-container p-4">

    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-5 border-bottom pb-4">
        <div class="mb-3 mb-md-0">
            <h1 class="display-4 fw-bold text-dark mb-0">Comunidad <span class="text-danger">PokéWeb</span></h1>
            <p class="text-muted lead mb-0">Noticias y eventos del mundo Pokémon.</p>
        </div>
        
        <button *ngIf="esCampeon || esAdmin" class="btn-poke-create" (click)="abrirModalCrear()">
            <span>NUEVA NOTICIA</span>
        </button>
    </div>

    <div *ngIf="cargando" class="text-center py-5">
        <div class="spinner-border text-danger" style="width: 3rem; height: 3rem;"></div>
    </div>

    <div *ngIf="!cargando && !error">
        
        <div *ngIf="noticiaDestacada" class="card hero-card shadow mb-5 border-0" 
             [routerLink]="['/noticia', noticiaDestacada.id]">
            <div class="row g-0">
                <div class="col-md-7 position-relative hero-img-container">
                    
                    <img [src]="noticiaDestacada.imagen ? (noticiaDestacada.imagen.startsWith('http') ? noticiaDestacada.imagen : baseUrl + noticiaDestacada.imagen) : 'assets/default-news.jpg'" 
                         class="img-fluid w-100 h-100 object-fit-cover" 
                         style="min-height: 350px; object-fit: cover;"
                         alt="Destacada">
                    
                    <span class="position-absolute top-0 start-0 m-3 badge bg-warning text-dark shadow fs-6">★ DESTACADA</span>
                    
                    <div *ngIf="esMiNoticia(noticiaDestacada)" class="admin-tools">
                        <button class="btn btn-light btn-sm rounded-circle shadow" (click)="abrirModalEditar(noticiaDestacada, $event)">
                            <i class="bi bi-pencil-fill text-primary"></i>
                        </button>
                        <button class="btn btn-light btn-sm rounded-circle shadow" (click)="borrarNoticia(noticiaDestacada.id, $event)">
                            <i class="bi bi-trash-fill text-danger"></i>
                        </button>
                    </div>
                </div>
                <div class="col-md-5 bg-dark text-white d-flex align-items-center">
                    <div class="card-body p-4 p-lg-5">
                        <small class="text-warning fw-bold text-uppercase mb-2 d-block">{{ noticiaDestacada.created_at | date:'longDate' }}</small>
                        <h2 class="display-6 fw-bold mb-3">{{ noticiaDestacada.titulo }}</h2>
                        <p class="lead opacity-75 text-truncate-multiline">{{ noticiaDestacada.resumen }}</p>
                        <button class="btn btn-outline-light rounded-pill mt-3 px-4">Leer artículo completo</button>
                    </div>
                </div>
            </div>
        </div>

        <h3 class="fw-bold mb-4 ps-3 border-start border-4 border-danger">Últimas Novedades</h3>
        <div class="row g-4">
            <div class="col-12 col-md-6 col-lg-4" *ngFor="let noticia of restoNoticias">
                <div class="card h-100 border-0 shadow-sm news-card" [routerLink]="['/noticia', noticia.id]">
                    
                    <div class="position-relative">
                        <img [src]="noticia.imagen ? (noticia.imagen.startsWith('http') ? noticia.imagen : baseUrl + noticia.imagen) : 'assets/default-news.jpg'" 
                             class="card-img-top" style="height: 220px; object-fit: cover;" alt="Noticia">
                        
                        <div *ngIf="esMiNoticia(noticia)" class="admin-tools">
                            <button class="btn btn-light btn-sm rounded-circle shadow" (click)="abrirModalEditar(noticia, $event)"><i class="bi bi-pencil-fill text-primary"></i></button>
                            <button class="btn btn-light btn-sm rounded-circle shadow" (click)="borrarNoticia(noticia.id, $event)"><i class="bi bi-trash-fill text-danger"></i></button>
                        </div>
                    </div>

                    <div class="card-body d-flex flex-column">
                        <small class="text-muted mb-2">{{ noticia.created_at | date:'mediumDate' }}</small>
                        <h5 class="fw-bold text-dark mb-2">{{ noticia.titulo }}</h5>
                        <p class="card-text text-secondary text-truncate-multiline flex-grow-1">{{ noticia.resumen }}</p>
                        <div class="mt-3 text-end">
                            <span class="text-danger fw-bold small">Leer más <i class="bi bi-arrow-right"></i></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal-backdrop fade show" *ngIf="mostrarModal"></div>
<div class="modal fade show" *ngIf="mostrarModal" tabindex="-1" style="display: block;">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg poke-modal">
      
      <div class="modal-header bg-danger text-white border-bottom border-4 border-dark">
        <h5 class="modal-title fw-bold">
            {{ esEdicion ? 'EDITAR DATOS' : 'NUEVA ENTRADA' }}
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="cerrarModal()"></button>
      </div>
      
      <div class="modal-body bg-light p-4">
          
          <div class="mb-3">
              <label class="fw-bold text-uppercase small text-muted">Título</label>
              <input type="text" class="form-control form-control-lg border-2" [(ngModel)]="formNoticia.titulo">
          </div>

          <div class="mb-3">
              <label class="fw-bold text-uppercase small text-muted mb-2">Imagen de Cabecera</label>
              <div class="p-4 border border-2 border-dashed rounded text-center bg-white position-relative" 
                   (click)="fileInput.click()" style="cursor: pointer;">
                  
                  <input #fileInput type="file" class="d-none" (change)="onFileSelected($event)" accept="image/*">
                  
                  <div *ngIf="subiendoImagen">
                      <div class="spinner-border text-danger mb-2"></div>
                      <p class="mb-0 fw-bold text-danger">Subiendo...</p>
                  </div>

                  <div *ngIf="!previewImagen && !subiendoImagen">
                      <i class="bi bi-cloud-upload fs-1 text-secondary mb-2"></i>
                      <p class="mb-0 fw-bold text-dark">Haz clic para subir imagen</p>
                  </div>

                  <div *ngIf="previewImagen && !subiendoImagen">
                      <img [src]="previewImagen" class="img-fluid rounded shadow-sm" style="max-height: 200px;">
                      <div class="mt-2"><span class="badge bg-secondary">Cambiar imagen</span></div>
                  </div>
              </div>
          </div>

          <div class="mb-3">
              <label class="fw-bold text-uppercase small text-muted">Resumen Corto</label>
              <textarea class="form-control border-2" rows="2" [(ngModel)]="formNoticia.resumen"></textarea>
          </div>

          <div class="mb-3">
              <label class="fw-bold text-uppercase small text-muted">Contenido</label>
              <textarea class="form-control border-2" rows="6" [(ngModel)]="formNoticia.contenido"></textarea>
          </div>
      </div>
      
      <div class="modal-footer bg-dark border-top border-4 border-white">
        <button class="btn btn-secondary rounded-pill px-4" (click)="cerrarModal()">CANCELAR</button>
        <button class="btn btn-danger rounded-pill px-5 fw-bold shadow" (click)="guardarNoticia()" [disabled]="subiendoImagen">
            GUARDAR
        </button>
      </div>

    </div>
  </div>
</div>