<div class="admin-container">
    
    <aside class="sidebar">
        <div class="brand">
            <i class="bi bi-shield-lock-fill text-danger"></i>
            <span>ADMIN PANEL</span>
        </div>
        
        <nav class="menu">
            <a [class.active]="seccion === 'home'" (click)="cambiarSeccion('home')">
                <i class="bi bi-speedometer2"></i> Dashboard
            </a>
            <a [class.active]="seccion === 'usuarios'" (click)="cambiarSeccion('usuarios')">
                <i class="bi bi-people-fill"></i> Usuarios
            </a>
            <a [class.active]="seccion === 'noticias'" (click)="cambiarSeccion('noticias')">
                <i class="bi bi-newspaper"></i> Noticias
            </a>
            <a [class.active]="seccion === 'equipos'" (click)="cambiarSeccion('equipos')">
                <i class="bi bi-trophy-fill"></i> Equipos
            </a>
        </nav>

        <div class="bottom-actions">
            <button class="btn-public" (click)="irWebPublica()">
                <i class="bi bi-eye-fill"></i> Ver Web Pública
            </button>
            <button class="btn-logout" (click)="logout()">
                <i class="bi bi-box-arrow-left"></i> Salir
            </button>
        </div>
    </aside>

    <main class="main-content">
        
        <div *ngIf="cargando" class="loading-overlay">
            <div class="spinner-border text-danger" role="status"></div>
        </div>

        <div *ngIf="seccion === 'home' && !cargando" class="animate-fade-in">
            <header class="header mb-4">
                <h1>Resumen Global</h1>
                <p class="text-muted">Estado actual de la plataforma.</p>
            </header>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="icon-box bg-primary-subtle text-primary"><i class="bi bi-people-fill"></i></div>
                    <div class="info"><h3>{{ stats.usuarios }}</h3><span>Usuarios</span></div>
                </div>
                <div class="stat-card">
                    <div class="icon-box bg-danger-subtle text-danger"><i class="bi bi-newspaper"></i></div>
                    <div class="info"><h3>{{ stats.noticias }}</h3><span>Noticias</span></div>
                </div>
                <div class="stat-card">
                    <div class="icon-box bg-success-subtle text-success"><i class="bi bi-trophy-fill"></i></div>
                    <div class="info"><h3>{{ stats.equipos }}</h3><span>Equipos</span></div>
                </div>
                <div class="stat-card">
                    <div class="icon-box bg-warning-subtle text-warning"><i class="bi bi-vinyl-fill"></i></div>
                    <div class="info"><h3>{{ stats.capturas }}</h3><span>Capturas</span></div>
                </div>
            </div>
        </div>

        <div *ngIf="seccion === 'usuarios' && !cargando" class="animate-fade-in">
            <h2 class="mb-4">Gestión de Usuarios</h2>
            <div class="table-responsive bg-dark rounded p-3 border border-secondary shadow-sm">
                <table class="table table-dark table-hover align-middle mb-0">
                    <thead>
                        <tr>
                            <th>Avatar</th>
                            <th>Usuario</th>
                            <th>Email</th>
                            <th>Rol</th>
                            <th class="text-end">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let u of listaUsuarios">
                            <td>
                                <img [src]="u.avatar ? 'uploads/avatars/' + u.avatar : 'assets/default.webp'" 
                                     class="rounded-circle border border-secondary" width="40" height="40" style="object-fit: cover;">
                            </td>
                            <td class="fw-bold">{{ u.username }}</td>
                            <td class="text-secondary">{{ u.email }}</td>
                            <td>
                                <span class="badge" [ngClass]="{'bg-danger': u.role==='admin', 'bg-primary': u.role!=='admin'}">
                                    {{ u.role | uppercase }}
                                </span>
                            </td>
                            <td class="text-end">
                                <button class="btn btn-sm btn-outline-warning me-2" (click)="editarUsuario(u)"><i class="bi bi-pencil"></i></button>
                                <button class="btn btn-sm btn-outline-danger" (click)="borrarUsuario(u)"><i class="bi bi-trash"></i></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div *ngIf="seccion === 'noticias' && !cargando" class="animate-fade-in">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Noticias</h2>
                <button class="btn btn-danger fw-bold shadow" (click)="crearNoticia()">+ Nueva</button>
            </div>

            <div class="table-responsive bg-dark rounded p-3 border border-secondary shadow-sm">
                <table class="table table-dark table-hover align-middle mb-0">
                    <thead>
                        <tr>
                            <th>Título</th>
                            <th>Autor (Email)</th> 
                            <th>Fecha</th>
                            <th class="text-center">Destacada</th>
                            <th class="text-end">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let n of listaNoticias">
                            <td class="fw-bold text-white">{{ n.titulo }}</td>
                            
                            <td class="text-muted small">
                                <i class="bi bi-envelope me-2"></i>
                                {{ n.autor_email || 'Usuario Eliminado' }}
                            </td>
                            
                            <td class="text-secondary small">{{ n.created_at | date:'dd/MM/yyyy' }}</td>
                            
                            <td class="text-center">
                                <i class="bi cursor-pointer fs-5" 
                                   [ngClass]="(n.destacada == 1 || n.destacada == '1') ? 'bi-star-fill text-warning' : 'bi-star text-secondary'" 
                                   (click)="toggleDestacada(n)"
                                   title="Destacar / Quitar"></i>
                            </td>
                            
                            <td class="text-end">
                                <button class="btn btn-sm btn-outline-info me-2" (click)="verNoticia(n.id)" title="Ver noticia">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" (click)="borrarNoticia(n)" title="Borrar">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div *ngIf="listaNoticias.length === 0" class="text-center py-4 text-muted">
                    No hay noticias publicadas.
                </div>
            </div>
        </div>

        <div *ngIf="seccion === 'equipos' && !cargando" class="animate-fade-in">
            <h2 class="mb-4">Equipos de la Comunidad</h2>
            <div class="table-responsive bg-dark rounded p-3 border border-secondary shadow-sm">
                <table class="table table-dark table-hover align-middle mb-0">
                    <thead>
                        <tr>
                            <th>Nombre Equipo</th>
                            <th>Entrenador</th>
                            <th>Email</th>
                            <th class="text-end">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let t of listaEquipos">
                            <td class="fw-bold text-warning">{{ t.name }}</td>
                            <td>{{ t.owner_name }}</td>
                            <td class="text-secondary font-monospace small">{{ t.owner_email }}</td>
                            <td class="text-end">
                                <button class="btn btn-sm btn-outline-danger" (click)="borrarEquipo(t)"><i class="bi bi-trash"></i></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </main>
</div>